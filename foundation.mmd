---
config:
  theme: neo
  layout: elk
---
flowchart TD
 subgraph External["ğŸŒ External Systems"]
        M365["ğŸ—‚ï¸ Microsoft 365 / SharePoint"]
        EntraID["Azure Entra ID"]
        DOPCT["DOP Call Tree Service"]
        Foundry["Azure AI Foundry"]
        Teams["ğŸ’¬ Teams / Outlook Interface"]
  end
 subgraph Core["ğŸ§© Core AI Platform Services"]
        UP["ğŸ“‡ User Profile Service<br><small>Extract job title, gender, reporting line, access role</small>"]
        EH["ğŸ•°ï¸ Episodic History Service<br><small>Store chat sessions as episodic memory</small>"]
        KG["ğŸ§  NER â†’ Knowledge Graph Service<br><small>Convert entities into KG triples</small>"]
        RAG["ğŸ“˜ RAG Pipeline Service<br><small>Index SharePoint docs, webhook sync</small>"]
        BC["âš™ï¸ Bot Creation Pipeline Service<br><small>Create &amp; deploy new bots</small>"]
        BR["ğŸ’¬ Bot Runtime Service<br><small>Handles inference and conversation logic</small>"]
        TWF["â±ï¸ Temporal Workflow Orchestrator<br><small>Manage document ingestion lifecycle<br>triggered by M365 or Admin</small>"]
  end
 subgraph Adv["ğŸ§  Advanced Intelligence & Governance Layer (Phase 6)"]
        SUM["ğŸª„ Auto-summary Service<br><small>Summarizes userâ€™s last N episodes</small>"]
        EXP["ğŸ” Explainability Panel Service<br><small>Show contributing docs &amp; KG triples</small>"]
        COST["ğŸ’° Cost-aware Response Service<br><small>Track token usage and cost</small>"]
        RET["ğŸ§¹ Data Retention &amp; Deletion Service<br><small>Compliance &amp; user â€œforgetâ€ flow</small>"]
        GOV["ğŸ›¡ï¸ AI Governance Service<br><small>Policy enforcement, audit, risk scoring</small>"]
  end
 subgraph Data["ğŸ’¾ Data & Storage Layer"]
        COSMOS[("ğŸª Cosmos DB")]
        SEARCH[("ğŸ” Cognitive Search Index")]
        BLOB[("ğŸ—ƒï¸ Blob Storage")]
        LOGS[("ğŸ“Š Log Analytics / App Insights")]
  end
    U["ğŸ‘¤ End User"] -- Chat / Create Bots --> UI["ğŸ§­ Bot Dashboard & Chat UI"]
    A["ğŸ§‘â€ğŸ’¼ Admin / Governance Officer"] -- Monitor / Manage Policies --> UI
    UI --> AGW["ğŸ§± API Gateway / Orchestrator"] & BR & GOV & EXP & COST
    AGW --> UP & EH & BC & BR & GOV & TWF
    M365 -- Webhook (doc uploaded) --> TWF
    A -- Trigger ingestion --> TWF
    TWF --> RAG & KG & BLOB & COSMOS & GOV
    EH --> SUM & COSMOS
    SUM --> COSMOS
    RAG --> SEARCH & COSMOS
    BR --> RAG & KG & EXP & COST & GOV
    GOV --> BLOB & COSMOS & LOGS
    RET --> COSMOS & BLOB
    COST --> LOGS
    BC --> GOV
    EntraID --> UP
    DOPCT --> UP
    Teams --> BR
    Foundry --> BR
    KG --> COSMOS
    UP --> COSMOS
    External --> n1["Untitled Node"]
     M365:::external
     Foundry:::external
     Teams:::external
     UP:::service
     EH:::service
     KG:::service
     RAG:::service
     BC:::service
     BR:::service
     TWF:::service
     SUM:::adv
     EXP:::adv
     COST:::adv
     RET:::adv
     GOV:::adv
     COSMOS:::data
     SEARCH:::data
     BLOB:::data
     LOGS:::data
     U:::ui
     UI:::ui
     A:::ui
    classDef service fill:#e6f3ff,stroke:#0078d4,stroke-width:1px,color:#111
    classDef data fill:#fff5e6,stroke:#ffb300,stroke-width:1px,color:#111
    classDef adv fill:#f4e6ff,stroke:#b36bff,stroke-width:1px,color:#111
    classDef external fill:#f2f2f2,stroke:#999,stroke-width:1px,color:#111
    classDef ui fill:#e6ffe6,stroke:#009933,stroke-width:1px,color:#111
